<!DOCTYPE html>
<html>
<head>
<title>Scope Capture App</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
​</head>

<body>

<link rel="stylesheet" type="text/css" href="../static/css/style.css"> -->
​<!-- <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}"> -->

<style>
  .bgimg {
/*    background-image: url('{{ url_for('video_feed') }}');*/
    background-image: url('img.jpg');    
    background-color: #000;
    min-height: 100%;
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    /*background-size: contain;*/
    margin: 0;
    padding: 0;
    position:relative;
  }
</style>
<div class="bgimg">
    
    
    <div class="settings-panel w3-display-left">
        <h2>Settings:</h2>
        <div>
            <span>WB: </span>
            <input type="range" min="2300" max="6600" value="6000" class="slider" id="wbSlider">
            <span id="wbSliderVal"></span>
        </div>
        <div>
            <span>Bright: </span>
            <input type="range" min="0" max="255" value="50" class="slider" id="brightnessSlider">
            <span id="brightnessSliderVal"></span>
        </div>
        <div>
            <span>Contrast: </span>
            <input type="range" min="0" max="255" value="100" class="slider" id="contrastSlider">
            <span id="contrastSliderVal"></span>
        </div>


<!--# Auto Focus 0-1-->
<!--# Absolute Focus 0-255-->
<!--# Backlight Compensation 0-8-->
<!--# Brightness 0-255-->
<!--# Contrast 0-255-->
<!--# Gain 0-10-->
<!--# Power Line frequency-->
<!--# Hue ?? -->
<!--# Saturation 0 - 255 -->
<!--# Gamma ?? -->
<!--# White Balance temperature 2300 - 6600 -->
<!--# White Balance temperature,Auto-->
    
      <p class="status" id="status">status...</p>

    </div>

  <div class="focus-control-buttons-panel w3-display-right">
      <button class="focus-control-button" onclick="set_scope_control('Absolute Focus', 1)"> F+ </button>
      <button class="focus-control-button" onclick="set_scope_control('Auto Focus', 1)">AF</button>
      <button class="focus-control-button" onclick="set_scope_control('Absolute Focus', -1)"> F- </button>
  </div>

  <div class="w3-display-bottommiddle">
    <button class="record-button"  onclick="save_scope_image()">REC</button>
  </div>
<!-- 
    <div class="video-feed">
        <img src="{{ url_for('video_feed') }}">
    </div>
 -->

</div>


<!-- JS SCRIPTS -->
<script src="../static/scripts/jquery.min.js"></script>
<!-- <script src="{{ url_for('static', filename='scripts/jquery.min.js') }}"></script> -->

<script>

    // Update Sliders values and send to Scope
    var sliders = document.querySelectorAll('.slider')
    sliders.forEach(item => {
        
        var labelId = item.id + "Val"
        var label = document.getElementById(labelId);
        label.innerHTML = item.value

        // Update slidera labels 
        item.oninput = function(){
            label.innerHTML = this.value
        }

        // Update actual scope setting with selected slider value
        item.onchange = function() {
            var controlId = this.id
            switch(controlId){
                case "wbSlider":
                    console.log("White Balance temperature:" + this.value);
                    set_scope_control('White Balance temperature', this.value)
                    break;
                case "brightnessSlider":
                    console.log("Brightness:" + this.value);
                    set_scope_control('Brightness', this.value)                    
                    break;
                case "contrastSlider":
                    console.log("Contrast:" + this.value);
                    set_scope_control('Contrast', this.value)                    
                    break;
            }

        }
    });

    // Set Scope Controls values function
    function set_scope_control(ctl, val) {

      $.ajax({
          type: 'POST',
          url: "/set_control",
          contentType: 'application/json;charset=UTF-8',
          data: JSON.stringify({'control': ctl, 'value': val}),
          success: function(result) {
                document.getElementById("status").innerHTML = result;
          },
          error: function(result) {
                document.getElementById("status").innerHTML = "ERROR!";
          }
      });

    };

    // Capture Scope image
    function save_scope_image(){
      $.ajax({
          type: 'POST',
          url: "/save_image",
          contentType: 'application/json;charset=UTF-8',
          success: function(result) {
                document.getElementById("status").innerHTML = result;
          },
          error: function(result) {
                document.getElementById("status").innerHTML = "ERROR!";
          }
      });
    }

</script>

</body>
</html>